<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Sneaking into Huawei Bootloader And ATCMDSERVER | TwizzyIndy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Sneaking into Huawei Bootloader &amp;amp; ATCMDSERVER PART I[ this article based and implemented on Autohacker’s blog post on CSDN ] OverviewI found a post the post which was on CSDN on past three years a">
<meta name="keywords" content="Huawei Bootloader">
<meta property="og:type" content="article">
<meta property="og:title" content="Sneaking into Huawei Bootloader And ATCMDSERVER">
<meta property="og:url" content="http://TwizzyIndy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/index.html">
<meta property="og:site_name" content="TwizzyIndy">
<meta property="og:description" content="Sneaking into Huawei Bootloader &amp;amp; ATCMDSERVER PART I[ this article based and implemented on Autohacker’s blog post on CSDN ] OverviewI found a post the post which was on CSDN on past three years a">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://twizzyindy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/media/15484909712505/Screen%20Shot%202018-12-29%20at%204.59.03%20PM.png">
<meta property="og:image" content="http://twizzyindy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/media/15484909712505/Screen%20Shot%202019-01-26%20at%203.29.33%20PM.png">
<meta property="og:image" content="http://twizzyindy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/media/15484909712505/Screen%20Shot%202019-01-26%20at%203.31.24%20PM.png">
<meta property="og:image" content="http://twizzyindy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/media/15484909712505/Screen%20Shot%202019-01-26%20at%203.33.47%20PM.png">
<meta property="og:image" content="http://twizzyindy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/media/15484909712505/Screen%20Shot%202019-01-26%20at%203.59.20%20PM.png">
<meta property="og:image" content="http://twizzyindy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/media/15484909712505/Screen%20Shot%202019-01-26%20at%204.01.40%20PM.png">
<meta property="og:updated_time" content="2019-01-26T09:31:59.251Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sneaking into Huawei Bootloader And ATCMDSERVER">
<meta name="twitter:description" content="Sneaking into Huawei Bootloader &amp;amp; ATCMDSERVER PART I[ this article based and implemented on Autohacker’s blog post on CSDN ] OverviewI found a post the post which was on CSDN on past three years a">
<meta name="twitter:image" content="http://twizzyindy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/media/15484909712505/Screen%20Shot%202018-12-29%20at%204.59.03%20PM.png">
  
    <link rel="alternative" href="/atom.xml" title="TwizzyIndy" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: false,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">TwizzyIndy</a></h1>
        </hgroup>

        
        <p class="header-subtitle">sometimes a good guy but .. sometimes a bad one ..</p>
        
        
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/tags">TAGS</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="mailto:twizzy.indy@gmail.com" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/TwizzyIndy" title="github">github</a>
                            
                                <a class="fl twitter" target="_blank" href="https://twitter.com/TwizzyIndy" title="twitter">twitter</a>
                            
                                <a class="fl facebook" target="_blank" href="https://facebook.com/twizzy.indy" title="facebook">facebook</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">a programmer, a reverse engineer</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">TwizzyIndy</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">TwizzyIndy</a></h1>
            </hgroup>
            
            <p class="header-subtitle">sometimes a good guy but .. sometimes a bad one ..</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/tags">TAGS</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="mailto:twizzy.indy@gmail.com" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/TwizzyIndy" title="github">github</a>
                    
                        <a class="twitter" target="_blank" href="https://twitter.com/TwizzyIndy" title="twitter">twitter</a>
                    
                        <a class="facebook" target="_blank" href="https://facebook.com/twizzy.indy" title="facebook">facebook</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/" class="article-date">
      <time datetime="2019-01-26T07:57:06.000Z" itemprop="datePublished">2019-01-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Sneaking into Huawei Bootloader And ATCMDSERVER
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Huawei-Bootloader/">Huawei Bootloader</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Sneaking-into-Huawei-Bootloader-amp-ATCMDSERVER-PART-I"><a href="#Sneaking-into-Huawei-Bootloader-amp-ATCMDSERVER-PART-I" class="headerlink" title="Sneaking into Huawei Bootloader &amp; ATCMDSERVER PART I"></a><strong>Sneaking into Huawei Bootloader &amp; ATCMDSERVER PART I</strong></h1><p>[ this article based and implemented on <a href="https://blog.csdn.net/autohacker/article/details/50715639" target="_blank" rel="noopener">Autohacker’s blog post on CSDN</a> ]</p>
<p><strong>Overview</strong><br>I found a post the post which was on CSDN on past three years ago.(yes its really old :( ). He gave us IDA Pro Database file to continuing analyzing for atcmdserver binary which existed in most of Hisilicon PoC based phones from Huawei. I kept reversing that binary since 2016.(but you should know im just a lazy reverse engineer.)</p>
<p><strong>What is atcmdserver and how it works?</strong><br>Huawei made that binary(located as /system/bin/atcmdserver) as a client which would do everything we sent AT commands from COM Port(Serial Port) and analyze them and output as programmed.</p>
<p>I guess (but its sure) Huawei made some authorized software which could do services like Changing Sales Region, Making Network Restrictions, Reading FRP Unlocking Keys, Reading Bootloader Unlock Codes, and much more…</p>
<p>First of all, that client softwares requesting authorize key from phone like this way. </p>
<p>“AT ^ CHECKAUTHORITY\r\n”<br><img src="media/15484909712505/Screen%20Shot%202018-12-29%20at%204.59.03%20PM.png" alt="Screen Shot 2018-12-29 at 4.59.03 P"></p>
<p>replied 128Bytes (really convert 128bytes into hex string.. so output is exactly 256 string ) ..</p>
<p>Lets take a look how this number comes from ..</p>
<p>Just load his database in IDA Pro and find the string AT CHECKAUTHORITY.<br><img src="media/15484909712505/Screen%20Shot%202019-01-26%20at%203.29.33%20PM.png" alt="Screen Shot 2019-01-26 at 3.29.33 P"></p>
<p>just find CHECKAUTHORITY so it would leads u to a global function<br><img src="media/15484909712505/Screen%20Shot%202019-01-26%20at%203.31.24%20PM.png" alt="Screen Shot 2019-01-26 at 3.31.24 P"></p>
<p>the function located on 0x36514. Decompile it.<br><img src="media/15484909712505/Screen%20Shot%202019-01-26%20at%203.33.47%20PM.png" alt="Screen Shot 2019-01-26 at 3.33.47 P"></p>
<p>in that function generate random 4 bytes from /dev/urandom and encrypt it using RSA-1020 (yes its 1020 bit) Bit Public Key. I pointed g_table that is a pointer to a factory public key including Modulus(N) and Exponent(E).<br>I think I need to explain how RSA Encryption works. RSA have two keys which are a public and a private. Encryption need just a public key but decryption doesnt. atcmdserver just encrypt random 4 bytes with Public Key and output the encrypted Big Integer array. So we have to decrypt them with Private Key and encrypt again with same private key and then send result to the phone via AT command as following :</p>
<p>AT ^ CONFORMAUTHORITY:8123884838348988…<br>reply: OKAY</p>
<p>we should take a look more in depth ..</p>
<p>decompile GenerateSeed function<br>it just put Random 4 bytes value into PKCS#1 1.5 Padding format.<br>the padded message would be like following ..</p>
<p>in hex<br>0001FFFFFFFF…FFFF00[generated random 4bytes]<br><img src="media/15484909712505/Screen%20Shot%202019-01-26%20at%203.59.20%20PM.png" alt="Screen Shot 2019-01-26 at 3.59.20 P"></p>
<p>and then the put padded formatted array into RSAPublicBlock and get output value.</p>
<p><img src="media/15484909712505/Screen%20Shot%202019-01-26%20at%204.01.40%20PM.png" alt="Screen Shot 2019-01-26 at 4.01.40 P"></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>Title:</span><a href="/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/">Sneaking into Huawei Bootloader And ATCMDSERVER</a></p>
        <p><span>Author:</span><a href="/" title="访问 TwizzyIndy 的个人博客">TwizzyIndy</a></p>
        <p><span>Posted:</span>2019-01-26 - 14:27</p>
        <p><span>Modified:</span>2019-01-26 - 16:01</p>
        <p>
            <span>URL:</span><a class="post-url" href="/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/" title="Sneaking into Huawei Bootloader And ATCMDSERVER">http://TwizzyIndy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/</a>
            <span class="copy-path" data-clipboard-text="原文: http://TwizzyIndy.github.io/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/　　作者: TwizzyIndy" title="CopyToClipboard"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
    </div>



<nav id="article-nav">
  
  
    <a href="/2016/11/01/About/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">About</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Sneaking-into-Huawei-Bootloader-amp-ATCMDSERVER-PART-I"><span class="toc-number">1.</span> <span class="toc-text">Sneaking into Huawei Bootloader &amp; ATCMDSERVER PART I</span></a></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>







    



    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2016/11/01/About/" title="下一篇: About">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/26/Sneaking-into-Huawei-Bootloader-And-ATCMDSERVER/">Sneaking into Huawei Bootloader And ATCMDSERVER</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/About/">About</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2019 TwizzyIndy
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>